<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WSU Sports Hub - User Login</title>
  <link rel="stylesheet" href="Style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #747474 0%, #080808 100%);
      min-height:100vh;
      color:#000;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .login-container {
      width:100%;
      max-width:400px;
      padding:2.5rem;
      background:white;
      border-radius:20px;
      box-shadow:0 20px 40px rgba(0,0,0,0.1);
      text-align:center;
      position:relative;
    }
    .modern-header { margin-bottom:2rem; }
    .header-icon {
      width:80px; height:80px;
      background:linear-gradient(135deg,#000,#333);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      margin:0 auto 1rem;
      box-shadow:0 10px 30px rgba(0,0,0,0.3);
    }
    .header-icon i { font-size:2rem; color:#fff; }
    .modern-header h2 { font-size:2rem; font-weight:700; color:#1f2937; margin-bottom:0.5rem; }
    .modern-header p { color:#6b7280; font-size:1rem; }

    .floating-input { position:relative; margin-bottom:1.5rem; }
    .floating-input input {
      width:100%;
      padding:1rem 0.75rem 0.5rem;
      border:none;
      border-bottom:2px solid #e5e7eb;
      background:transparent;
      font-size:1rem;
      outline:none;
      transition:all 0.3s ease;
    }
    .floating-input label {
      position:absolute;
      left:0.75rem; top:1rem;
      color:#9ca3af;
      font-size:1rem;
      pointer-events:none;
      transition:all 0.3s ease;
    }
    .floating-input input:focus + label,
    .floating-input input:not(:placeholder-shown) + label {
      top:0.25rem;
      font-size:0.75rem;
      color:#000;
      font-weight:500;
    }
    .input-line {
      position:absolute; bottom:0; left:0;
      width:0; height:2px;
      background:linear-gradient(135deg,#000,#333);
      transition:width 0.3s ease;
    }
    .floating-input input:focus ~ .input-line { width:100%; }

    .toggle-pwd {
      position:absolute;
      right:10px; top:15px;
      cursor:pointer;
      color:#6b7280;
    }

    .modern-btn {
      width:100%;
      padding:1rem;
      background:linear-gradient(135deg,#000,#333);
      color:white;
      border:none;
      border-radius:12px;
      font-size:1rem;
      font-weight:600;
      cursor:pointer;
      transition:all 0.3s ease;
      margin:1.5rem 0 1rem;
      position:relative;
      overflow:hidden;
    }
    .modern-btn:hover { transform:translateY(-2px); box-shadow:0 10px 25px rgba(0,0,0,0.4); }
    .modern-btn:active { transform:translateY(0); }

    .form-divider {
      margin:1.5rem 0;
      text-align:center;
      position:relative;
    }
    .form-divider::before {
      content:'';
      position:absolute;
      top:50%; left:0; right:0;
      height:1px; background:#e5e7eb;
    }
    .form-divider span { background:white; padding:0 1rem; color:#6b7280; font-size:0.9rem; }

    .link-btn {
      width:100%;
      padding:0.75rem;
      background:transparent;
      color:#000;
      border:2px solid #000;
      border-radius:12px;
      font-size:1rem;
      font-weight:500;
      cursor:pointer;
      transition:all 0.3s ease;
      margin-bottom:1rem;
    }
    .link-btn:hover { background:#000; color:white; transform:translateY(-1px); }

    .error, .success {
      padding:10px; border-radius:5px; margin-bottom:1rem; display:none;
    }
    .error { background:#fee; color:#c33; border:1px solid #fcc; }
    .success { background:#e6ffed; color:#2e7d32; border:1px solid #a5d6a7; }

    .forgot-link { display:inline-block; margin-top:1rem; color:#000; font-size:0.9rem; text-decoration:none; }
    .forgot-link:hover { color:#333; text-decoration:underline; }

    @media(max-width:768px) {
      .login-container { margin:30px 20px; padding:2rem; }
      .modern-header h2 { font-size:1.75rem; }
      .header-icon { width:70px; height:70px; }
      .header-icon i { font-size:1.75rem; }
    }
    @media(max-width:480px) {
      .modern-btn, .link-btn { font-size:0.95rem; padding:0.85rem; border-radius:10px; width:100%; }
      .btn-text { font-size:1rem; }
    }
  </style>
</head>
<body>

<div class="login-container">
  <div class="modern-header">
    <div class="header-icon"><i class="fas fa-user-shield"></i></div>
    <h2>Welcome Back</h2>
    <p>Sign in to access your WSU account</p>
  </div>

  <div id="error" class="error"></div>
  <div id="success" class="success"></div>

  <div class="floating-input">
    <input type="text" id="student_number" placeholder=" " required>
    <label for="student_number">Student Number</label>
    <div class="input-line"></div>
  </div>

  <div class="floating-input">
    <input type="email" id="email" placeholder=" " readonly>
    <label for="email">Email Address</label>
    <div class="input-line"></div>
  </div>

  <div class="floating-input">
    <input type="password" id="password" placeholder=" " required>
    <label for="password">Password</label>
    <i id="togglePwd" class="fas fa-eye toggle-pwd"></i>
    <div class="input-line"></div>
  </div>

  <button id="loginBtn" class="modern-btn"><span class="btn-text">Sign In</span></button>

  <div class="form-divider"><span>Don't have an account?</span></div>

  <a href="register.html"><button class="link-btn">Create New Account</button></a>
  <a href="forgot.html" class="forgot-link">Forgot your password?</a>
</div>

<script>
  const supabaseUrl = 'https://mqvjbgnipsjygmpwidnq.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1xdmpiZ25pcHNqeWdtcHdpZG5xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxNDkyNzQsImV4cCI6MjA2NzcyNTI3NH0.p-mZxDCirt9NY_3taGk7_mL-qK5zTR05jInt6FEWs4Y';
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  const studentNumberInput = document.getElementById('student_number');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const loginBtn = document.getElementById('loginBtn');
  const errorDiv = document.getElementById('error');
  const successDiv = document.getElementById('success');

  // Auto-populate email
  studentNumberInput.addEventListener('input', function() {
    const studentNumber = this.value.trim();
    emailInput.value = studentNumber ? studentNumber + '@mywsu.ac.za' : '';
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';
  });

  passwordInput.addEventListener('input', () => { 
    errorDiv.style.display='none'; 
    successDiv.style.display='none'; 
  });

  // Toggle password visibility
  document.getElementById('togglePwd').addEventListener('click', () => {
    passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
  });

  // Trigger login when Enter is pressed in student number or password
  [studentNumberInput, passwordInput].forEach(input => {
    input.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        login();
      }
    });
  });

  // Trigger login on button click
  loginBtn.addEventListener('click', login);

  async function login() {
    const studentNumber = studentNumberInput.value.trim();
    const email = emailInput.value;
    const password = passwordInput.value;
    const originalText = loginBtn.innerHTML;

    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';

    if (!studentNumber || !password) {
      errorDiv.textContent = "Please enter both student number and password.";
      errorDiv.style.display = 'block';
      return;
    }

    if (!/^\d{9}$/.test(studentNumber)) {
      errorDiv.textContent = "Student number must be exactly 9 digits.";
      errorDiv.style.display = 'block';
      return;
    }

    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
    loginBtn.disabled = true;

    try {
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        errorDiv.textContent = error.message;
        errorDiv.style.display = 'block';
        loginBtn.innerHTML = originalText;
        loginBtn.disabled = false;
      } else {
        successDiv.textContent = "Login successful! Redirecting...";
        successDiv.style.display = 'block';
        loginBtn.innerHTML = '<i class="fas fa-check"></i> Welcome...';
        setTimeout(() => window.location.href = 'home.html', 1500);
      }
    } catch (err) {
      errorDiv.textContent = "Unexpected error occurred. Please try again.";
      errorDiv.style.display = 'block';
      loginBtn.innerHTML = originalText;
      loginBtn.disabled = false;
    }
  }

  // Session timeout in milliseconds (e.g., 5 minutes = 300000ms)
  const sessionTimeout = 3 * 60 * 1000; 
  let sessionTimer;

  function startSessionTimer() {
    sessionTimer = setTimeout(() => {
      alert("Your session has timed out due to inactivity.");
      // Redirect to login page (or homepage)
      window.location.href = "index.html"; 
    }, sessionTimeout);
  }

  function resetSessionTimer() {
    clearTimeout(sessionTimer);
    startSessionTimer();
  }

  // Start the timer when page loads
  startSessionTimer();

  // Reset timer on user interactions
  document.addEventListener("mousemove", resetSessionTimer);
  document.addEventListener("keydown", resetSessionTimer);
  document.addEventListener("click", resetSessionTimer);
  document.addEventListener("scroll", resetSessionTimer);
</script>

</body>
</html>

